
<div class="card-head mb-2 d-flex align-items-center justify-content-between">
    <h1 class="section-title">{{fieldTitle['subledger']}}</h1>
</div>
<div class="card-section">
    <div class="top-card-box p-3 pb-1 mb-3">
        <form #ledgerReportForm="ngForm" [addValidators]="validationMsgObj" validationMessage="subGroupLedgerModelValidation">
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <label class="ni-sup">{{fieldTitle['company']}}</label>
                            </div>
                            <div class="col-md-8">
                                <!-- <p-dropdown appendTo="body" placeholder="Select Company"
                                    [(ngModel)]="modelSvc.searchParam.companyID" 
                                    [filter]="true" 
                                    [options]="modelSvc.companyList" 
                                    name="companyID" 
                                    (onChange)="onChangeCompany()" 
                                    optionLabel="name"
                                    optionValue="id"
                                    [niSelectedText]="modelSvc.searchParam"
                                    textProperty="companyName"
                                    inputValidator
                                    [style]="{ width: '100%' }">
                                </p-dropdown> -->

                              <p-dropdown *ngIf="!isPlaceholderDisableCompany" appendTo="body" placeholder="Select Company" [(ngModel)]="modelSvc.searchParam.companyID"
                                [filter]="true" [options]="modelSvc.companyList" name="companyID" (onChange)="onChangeCompany()"
                                optionLabel="name" optionValue="id" [niSelectedText]="modelSvc.searchParam" textProperty="companyName"
                                inputValidator [style]="{ width: '100%' }">
                              </p-dropdown>
              
                              <p-dropdown *ngIf="isPlaceholderDisableCompany" appendTo="body" [(ngModel)]="modelSvc.searchParam.companyID"
                                [filter]="true" [options]="modelSvc.companyList" name="companyID" (onChange)="onChangeCompany()"
                                optionLabel="name" optionValue="id" [niSelectedText]="modelSvc.searchParam" textProperty="companyName"
                                inputValidator [style]="{ width: '100%' }">
                              </p-dropdown>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4" *ngIf="modelSvc.isBranchModuleActive">
                    <div class="form-group">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <label>{{fieldTitle['office/branch/unit']}}</label>
                            </div>
                            <div class="col-md-8">
                                <p-dropdown appendTo="body" placeholder="Select Office/Branch/Unit"
                                    [(ngModel)]="modelSvc.searchParam.orgID" 
                                    [filter]="true" 
                                    [niSelectedText]="modelSvc.searchParam"
                                    textProperty="unitBranch"
                                    [group]="true" 
                                    (onChange)="onChangeSPParameterData()" 
                                    [showClear]="true"
                                    [options]="modelSvc.officeBranchUnitList" 
                                    filterBy="name"
                                    name="orgID"
                                    optionLabel="name" optionValue="id" [group]="true"
                                    [style]="{ width: '100%' }">
                                    <ng-template let-group pTemplate="group">
                                        <div class="flex align-items-center">
                                            <span>{{ group.label }}</span>
                                        </div>
                                    </ng-template>
                                </p-dropdown> 
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4" *ngIf="modelSvc.isProjectModuleActive">
                    <div class="form-group">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <label>{{fieldTitle['project']}}</label>
                            </div>
                            <div class="col-md-8">
                                <p-dropdown appendTo="body" placeholder="Select Project"
                                    [(ngModel)]="modelSvc.searchParam.projectID" 
                                    [filter]="true"
                                    filterBy="name"
                                    [niSelectedText]="modelSvc.searchParam"
                                    textProperty="project" 
                                    (onChange)="onChangeSPParameterData()"
                                    [showClear]="true"
                                    [options]="modelSvc.projectList" 
                                    name="orgID" 
                                    optionLabel="name"
                                    optionValue="id"
                                    [style]="{ width: '100%' }">
                                </p-dropdown>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <label class="ni-sup">{{fieldTitle['subledgertype']}}</label>
                            </div>
                            <div class="col-md-8">
                                <p-dropdown appendTo="body" *ngIf="!isPlaceholderDisableSubLedgerType" placeholder="Select Sub Ledger Type"
                                    [(ngModel)]="modelSvc.searchParam.subLedgerTypeID" 
                                    (onChange)="onChangeSubLedgerType()"
                                    [niSelectedText]="modelSvc.searchParam"
                                    textProperty="subLedgerTypeName"
                                    [filter]="true"
                                    filterBy="name" 
                                    [showClear]="false"
                                    [options]="modelSvc.subLedgerTypeList" 
                                    name="subLedgerTypeID" inputValidator
                                    optionLabel="name"
                                    optionValue="id"
                                    [style]="{ width: '100%' }">
                                </p-dropdown>

                                <p-dropdown appendTo="body" *ngIf="isPlaceholderDisableSubLedgerType"
                                    [(ngModel)]="modelSvc.searchParam.subLedgerTypeID" 
                                    (onChange)="onChangeSubLedgerType()"
                                    [niSelectedText]="modelSvc.searchParam"
                                    textProperty="subLedgerTypeName"
                                    [filter]="true"
                                    filterBy="name" 
                                    [showClear]="false"
                                    [options]="modelSvc.subLedgerTypeList" 
                                    name="subLedgerTypeID" inputValidator
                                    optionLabel="name"
                                    optionValue="id"
                                    [style]="{ width: '100%' }">
                                </p-dropdown>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <label class="ni-sup">{{fieldTitle['ledgername']}}</label>
                            </div>
                            <div class="col-md-8">
                                <p-dropdown appendTo="body" *ngIf="!isPlaceholderDisableLedger" placeholder="Select Ledger"
                                    [(ngModel)]="modelSvc.searchParam.ledgerID" 
                                    (onChange)="onChangeGroupLedger()" 
                                    [niSelectedText]="modelSvc.searchParam"
                                    textProperty="ledgerName"
                                    [filter]="true"
                                    filterBy="name" 
                                    [showClear]="false"
                                    [options]="modelSvc.ledgerList | arrayFilter: { subLedgerTypeID: modelSvc.searchParam.subLedgerTypeID || null}"
                                    name="ledgerID" 
                                    optionLabel="name"
                                    optionValue="id" inputValidator
                                    [style]="{ width: '100%' }">
                                </p-dropdown>

                                <p-dropdown appendTo="body" *ngIf="isPlaceholderDisableLedger"
                                    [(ngModel)]="modelSvc.searchParam.ledgerID" 
                                    (onChange)="onChangeGroupLedger()" 
                                    [niSelectedText]="modelSvc.searchParam"
                                    textProperty="ledgerName"
                                    [filter]="true"
                                    filterBy="name" 
                                    [showClear]="false"
                                    [options]="modelSvc.ledgerList | arrayFilter: { subLedgerTypeID: modelSvc.searchParam.subLedgerTypeID || null}"
                                    name="ledgerID" 
                                    optionLabel="name"
                                    optionValue="id" inputValidator
                                    [style]="{ width: '100%' }">
                                </p-dropdown>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <label class="ni-sup">{{fieldTitle['daterange']}}</label>
                            </div>
                            <div class="col-md-8">
                                <div class="row g-1">
                                    <div class="col-md-6">
                                        <p-calendar appendTo="body" dateFormat="dd/mm/yy" [(ngModel)]="modelSvc.searchParam.fromDate" name="fromDate"
                                        [readonlyInput]="true" 
                                        [showIcon]="true" 
                                        [maxDate]="modelSvc.searchParam.toDate"
                                        (onSelect)="onChangeFromDate()" 
                                        [style]="{ width: '100%' }" 
                                        inputValidator>
                                        </p-calendar>
                                    </div>
                                    <div class="col-md-6">
                                        <p-calendar appendTo="body" dateFormat="dd/mm/yy" [(ngModel)]="modelSvc.searchParam.toDate" name="toDate"
                                        [readonlyInput]="true" 
                                        [showIcon]="true"  
                                        [minDate]="modelSvc.searchParam.fromDate"
                                        (onSelect)="onChangeToDate()" 
                                        [maxDate]="modelSvc.maxDate"
                                        [style]="{ width: '100%' }" 
                                        inputValidator>
                                        </p-calendar>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <div class="form-row d-flex align-items-center justify-content-end">
                            <button type="button" class="btn btn-sm btn-warning" 
                            (click)="reset()" >
                                <img src="../../../assets/images/icons/repeat.svg" alt="icon">Reset
                            </button>
                            <button type="button" class="btn btn-sm btn-primary" 
                            (click)="search(ledgerReportForm)">
                                <img src="../../../assets/images/icons/search.svg" alt="icon"> Search
                            </button>
                            <button type="button" class="btn btn-sm btn-danger" 
                            (click)="onExport(ledgerReportForm, true)">
                                <img src="../../../assets/images/icons/download.svg" alt="icon">
                                {{fieldTitle['export']}}
                            </button>
                            <button type="button" class="btn btn-sm btn-success"  (click)="onExport(ledgerReportForm, false)">
                                <img src="../../../assets/images/icons/send.svg" alt="icon">
                                {{fieldTitle['sendemail']}}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <app-ni-table [gridOption]="gridOption" [valueList]="modelSvc.subLedgerList">
        <ng-template pTemplate="body" let-entity let-rowIndex="rowIndex">
            <tr>
                <td>{{ entity.sL }}</td>
                <td>{{ entity.particulars }}</td>
                <td class="text-end">{{ entity.payableVal | number : "1.2-2" }}</td>
                <td class="text-end">{{ entity.receivableVal | number : "1.2-2"}}</td>
            </tr>
        </ng-template>
        <ng-template pTemplate="footer">
            <tr>
                <td colspan="2" class="text-start">{{fieldTitle['transactionalbalance']}}</td>
                <td class="text-end">{{modelSvc.totalDebit | number : "1.2-2"}}</td>
                <td class="text-end">{{modelSvc.totalCredit | number : "1.2-2"}}</td>
            </tr>
        </ng-template>
    </app-ni-table>
</div>