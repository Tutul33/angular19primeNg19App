
<div class="card-head mb-2 d-flex align-items-center justify-content-between">
    <h1 class="section-title">{{fieldTitle['groupledger']}}</h1>
</div>
<div class="card-section">
    <div class="top-card-box p-3 pb-1 mb-3">
        <form #ledgerReportForm="ngForm" [addValidators]="validationMsgObj" validationMessage="groupLedgerModelValidation">
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <label class="ni-sup">{{fieldTitle['company']}}</label>
                            </div>
                            <div class="col-md-8">
                                <!-- <p-dropdown appendTo="body" placeholder="Select Company"
                                    [(ngModel)]="modelSvc.searchParam.companyID" 
                                    [filter]="true" 
                                    [options]="modelSvc.companyList" 
                                    name="companyID" 
                                    (onChange)="onChangeCompany()" 
                                    optionLabel="name"
                                    optionValue="id"
                                    [niSelectedText]="modelSvc.searchParam"
                                    textProperty="companyName"
                                    inputValidator
                                    [style]="{ width: '100%' }">
                                </p-dropdown> -->

                              <p-dropdown *ngIf="!isPlaceholderDisableCompany" appendTo="body" placeholder="Select Company" [(ngModel)]="modelSvc.searchParam.companyID"
                                [filter]="true" [options]="modelSvc.companyList" name="companyID" (onChange)="onChangeCompany()"
                                optionLabel="name" optionValue="id" [niSelectedText]="modelSvc.searchParam" textProperty="companyName"
                                inputValidator [style]="{ width: '100%' }">
                              </p-dropdown>
              
                              <p-dropdown *ngIf="isPlaceholderDisableCompany" appendTo="body" [(ngModel)]="modelSvc.searchParam.companyID"
                                [filter]="true" [options]="modelSvc.companyList" name="companyID" (onChange)="onChangeCompany()"
                                optionLabel="name" optionValue="id" [niSelectedText]="modelSvc.searchParam" textProperty="companyName"
                                inputValidator [style]="{ width: '100%' }">
                              </p-dropdown>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4" *ngIf="modelSvc.isBranchModuleActive">
                    <div class="form-group">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <label>{{fieldTitle['office/branch/unit']}}</label>
                            </div>
                            <div class="col-md-8">
                                <p-dropdown appendTo="body" placeholder="Select Office/Branch/Unit"
                                    [(ngModel)]="modelSvc.searchParam.orgID" 
                                    [filter]="true" 
                                    [niSelectedText]="modelSvc.searchParam"
                                    textProperty="unitBranch"
                                    [group]="true" 
                                    [showClear]="true"
                                    [options]="modelSvc.officeBranchUnitList" 
                                    filterBy="name"
                                    name="orgID" 
                                    optionLabel="name" optionValue="id" [group]="true"
                                    [style]="{ width: '100%' }">
                                    <ng-template let-group pTemplate="group">
                                        <div class="flex align-items-center">
                                            <span>{{ group.label }}</span>
                                        </div>
                                    </ng-template>
                                </p-dropdown> 
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4" *ngIf="modelSvc.isProjectModuleActive">
                    <div class="form-group">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <label>{{fieldTitle['project']}}</label>
                            </div>
                            <div class="col-md-8">
                                <p-dropdown appendTo="body" placeholder="Select Project"
                                    [(ngModel)]="modelSvc.searchParam.projectID" 
                                    [niSelectedText]="modelSvc.searchParam"
                                    textProperty="project"
                                    [filter]="true"
                                    filterBy="name" 
                                    [showClear]="true"
                                    [options]="modelSvc.projectList" 
                                    name="orgID" 
                                    optionLabel="name"
                                    optionValue="id"
                                    [style]="{ width: '100%' }">
                                </p-dropdown>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <label class="ni-sup">{{fieldTitle['groupledgername']}}</label>
                            </div>
                            <div class="col-md-8">
                              <!-- <p-treeSelect appendTo="body"
                                [options]="modelSvc.treeDataList" 
                                filterMode="strict" 
                                filterPlaceholder="Search Ledger"
                                placeholder="{{fieldTitle['selectgroupledgername']}}"
                                selectionMode="single"
                                [filter]="true" class="admin-menus">
                                <ng-template let-node pTemplate="default" class="d-flex justify-content-between">
                                    <span (click)="onNodeClick(node)" class="w-100">{{node.label}}</span>
                                </ng-template>
                              </p-treeSelect> -->

                              <p-treeSelect appendTo="body" placeholder="{{fieldTitle['selectgroupledgername']}}"
                                    [(ngModel)]="node" 
                                    [options]="modelSvc.treeDataList" 
                                    name="groupLedgerID" 
                                    optionLabel="label"
                                    optionValue="id"
                                    selectionMode="single"
                                    filterMode="strict"
                                    [filter]="true"
                                    (onNodeSelect)="onNodeClick(node)"
                                    [style]="{ width: '100%' }">
                                </p-treeSelect>
                            </div>
                        </div>   
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <label class="ni-sup">{{fieldTitle['daterange']}}</label>
                            </div>
                            <div class="col-md-8">
                                <div class="row g-1">
                                    <div class="col-md-6">
                                        <p-calendar appendTo="body" dateFormat="dd/mm/yy" [(ngModel)]="modelSvc.searchParam.fromDate" name="fromDate"
                                        [readonlyInput]="true" 
                                        [showIcon]="true" 
                                        (onSelect)="onChangeFromDate()" 
                                        [maxDate]="modelSvc.searchParam.toDate"
                                        [style]="{ width: '100%' }" 
                                        inputValidator>
                                        </p-calendar>
                                    </div>
                                    <div class="col-md-6">
                                        <p-calendar appendTo="body" dateFormat="dd/mm/yy" [(ngModel)]="modelSvc.searchParam.toDate" name="toDate"
                                        [readonlyInput]="true" 
                                        [showIcon]="true"  
                                        [minDate]="modelSvc.searchParam.fromDate"
                                        (onSelect)="onChangeToDate()" 
                                        [maxDate]="modelSvc.maxDate"
                                        [style]="{ width: '100%' }" 
                                        inputValidator>
                                        </p-calendar>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <div class="form-row d-flex align-items-center justify-content-end">
                        <button type="button" class="btn btn-sm btn-warning" 
                         (click)="reset()" >
                            <img src="../../../assets/images/icons/repeat.svg" alt="icon">Reset
                        </button>
                        <button type="button" class="btn btn-sm btn-primary" 
                         (click)="search()">
                            <img src="../../../assets/images/icons/search.svg" alt="icon"> Search
                        </button>
                        <button type="button" class="btn btn-sm btn-danger" 
                         (click)="onExport(true)">
                            <img src="../../../assets/images/icons/download.svg" alt="icon">
                            {{fieldTitle['export']}}
                        </button>
                        <button type="button" class="btn btn-sm btn-success"  (click)="onExport(false)">
                            <img src="../../../assets/images/icons/send.svg" alt="icon">
                            {{fieldTitle['sendemail']}}
                        </button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <app-ni-table [gridOption]="gridOption" [valueList]="modelSvc.groupLedgerList">
        <ng-template pTemplate="body" let-entity let-rowIndex="rowIndex">
            <tr>
                <td>{{ entity.sL }}</td>
                <td>{{ entity.particulars }}</td>
                <td class="text-end">{{ entity.debitVal | number : "1.4-4" }}</td>
                <td class="text-end">{{ entity.creditVal | number : "1.4-4"}}</td>
            </tr>
        </ng-template>
    </app-ni-table>
</div>